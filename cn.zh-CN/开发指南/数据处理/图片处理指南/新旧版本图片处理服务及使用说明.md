# 新旧版本图片处理服务及使用说明

图片处理服务目前提供新旧两版服务，本文介绍两版服务的主要区别。

## 新旧版本图片处理服务的主要区别

在添加处理参数时，新旧版本服务中的格式不同，区别如下：

-   新版参数格式：`http://bucket.<endpoint>/object?x-oss-process=image/action,parame_value`

    所有的图片处理操作都通过`x-oss-process`进行传递。每个action之间顺序执行。

-   旧版参数格式：`http://channel.<endpoint>/object@action.format`

    操作通过`@`作为分隔符进行处理。


## 通过OSS域名及通过IMG域名访问处理后图片的区别

使用旧版图片处理服务处理图片，会为图片生成专门的IMG域名。而使用新版服务处理图片，图片仍然使用OSS域名。通过两种域名访问处理后图片时的区别如下表所示。

|对比项|采用IMG域名访问|直接使用OSS域名访问|
|---|---------|-----------|
|使用方式|存储与处理两套域名系统|上传、管理、处理、分发，一站式处理|
|是否支持新版API|支持|支持|
|是否支持旧版API|支持|默认不支持|
|是否支持HTTPS|不支持|支持|
|是否支持VPC网络|不支持|支持|
|是否支持多域名绑定|不支持|支持|
|是否支持源站更新自动刷新阿里CDN|不支持|支持|

**说明：**

-   OSS域名已全面支持图片处理服务，不过只能使用新版服务的API。而原有的IMG域名能够使用新旧两个版本的API。
-   如果IMG域名期望能够进行CDN加速，可以通过在CDN配置回源host的方式直接访问IMG域名，不需要进行域名绑定来完成CDN加速。

## 使用新旧版本图片处理功能Bucket的区别

开启过旧版图片处理服务的Bucket：

-   与旧版图片处理功能逻辑基本一致。用户看到的图片域名是使用旧版服务时生成的IMG域名，以及之前已经绑定的自定义域名。
-   通过旧版服务进行的原图保护等配置，只对之前生成的IMG域名有效，对于文件的OSS域名没有效果。当在跨区域复制中开启同步时，会将原图保护以及样式分隔符同步到OSS域名。
-   当用户关闭当前Bucket的图片处理服务时，会清空样式配置以及域名绑定，并自动跳转到新版的页面。

新创建的Bucket或者之前没有开启旧版图片处理服务的Bucket：

-   默认能够使用图片处理服务，无需开通。
-   无需绑定域名，域名绑定操作直接同Bucket本身的域名管理一致。

## 使用旧版图片处理服务的用户如何切换至新版图片处理服务

旧版图片处理服务的API暂时无法在新版图片处理服务中使用，如有特殊情况可以工单联系售后技术支持。但如果您在旧版图片处理服务中只通过样式访问图片，则可以通过以下步骤进行切换：

-   在当前图片服务配置里面开启配置同步，样式分隔符以及原图保护能够同步到新版图片处理服务。
-   如果使用了自定义域名，将原有的自定义域名CNAME改到OSS域名即可。

## 新旧版图片处理服务的样式配置是否一致

所有的样式配置在新旧版的图片处理服务中是共享的，旧版图片处理服务的样式配置在新版中可以正常使用。

